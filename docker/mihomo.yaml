mixed-port: 7890
# http(s)/socks/mixedä»£ç†çš„ç”¨æˆ·éªŒè¯
# authentication:
# - "user1:pass1"
# - "user2:pass2"
authentication: [""]
allow-lan: true
log-level: error
ipv6: false
unified-delay: true
# tcp-concurrent: true
external-controller: :9090
secret: "mihomo666"
external-ui: ui
external-ui-url: "https://docker.lzdrc.cf/https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip"

geodata-mode: false
# GEO æ–‡ä»¶åŠ è½½æ¨¡å¼ï¼ˆstandardï¼šæ ‡å‡†åŠ è½½å™¨/memconservativeï¼šä¸“ä¸ºå†…å­˜å—é™ (å°å†…å­˜) è®¾å¤‡ä¼˜åŒ–çš„åŠ è½½å™¨ (é»˜è®¤å€¼)ï¼‰
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 48
geox-url:
  geoip: "https://docker.lzdrc.cf/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat"
  geosite: "https://docker.lzdrc.cf/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://docker.lzdrc.cf/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country-lite.mmdb"
  asn: "https://docker.lzdrc.cf/https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"

# ç”¨äºä¸‹è½½è®¢é˜…æ—¶æŒ‡å®šUA
global-ua: clash.meta

tun:
  enable: true
  stack: mixed
  dns-hijack:
   - any:1053
   - tcp://any:1053
  # auto-route: true
  # auto-redirect: true
  # auto-detect-interface: true


dns:
    enable: true
    listen: '0.0.0.0:1053'
    ipv6: false
    concurrent: true
    respect-rules: true
    use-hosts: false
    use-system-hosts: true
    
    enhanced-mode: fake-ip
    fake-ip-range: 100.127.0.0/17
    fake-ip-filter-mode: blacklist
    fake-ip-filter:
      - "*"
      - "+.lan"
      - "+.local"
      - "+.market.xiaomi.com"
      - "rule-set:cn_domain,direct_domain,ai_domain_cn"

    default-nameserver: [119.29.29.29, 223.5.5.5]

    nameserver:
      - https://120.53.53.53/dns-query
      - https://223.5.5.5/dns-query

    proxy-server-nameserver:
      - https://120.53.53.53/dns-query
      - https://223.5.5.5/dns-query

    nameserver-policy:
      '+.arpa': '192.168.50.254'
      'rule-set:cn_domain,direct_domain,ai_domain_cn':
        - https://223.6.6.6/dns-query
        - https://120.53.53.53/dns-query
      'rule-set:geolocation-!cn,proxy_domain,youtube_domain,google_domain,spotify_domain,ai_domain,ai_domain_!cn,github_domain,twitter_domain,telegram_domain,netflix_domain,bahamut_domain,bilibili_domain':
        - https://dns.google/dns-query
        - https://cloudflare-dns.com/dns-query

######### é”šç‚¹ start #######
#è¿™é‡Œæ˜¯è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³çš„
pp: &pp {type: http, interval: 3600, health-check: {enable: true, url: "https://www.apple.com/library/test/success.html", interval: 300}}
######### é”šç‚¹ end #######
proxy-providers:
  SubLink:
    url: "ä½ çš„è®¢é˜…é“¾æ¥"
    path: "./providers/SubLink.yaml"
    <<: *pp

  Home:
    url: "ä½ çš„è®¢é˜…é“¾æ¥"
    path: "./providers/Home.yaml"
    <<: *pp 

######### é”šç‚¹ start #######
#è¿™é‡Œæ˜¯ç­–ç•¥ç»„ç±»å‹ç›¸å…³çš„
fb: &fb {type: fallback, url: 'https://www.apple.com/library/test/success.html', interval: 60, lazy: true, timeout: 3000, max-failed-times: 2}
ut: &ut {type: url-test, tolerance: 100, lazy: true, url: 'https://www.apple.com/library/test/success.html', interval: 300}
lb: &lb {type: load-balance, strategy: consistent-hashing, lazy: true, url: 'https://www.apple.com/library/test/success.html', interval: 300}
dr: &dr {type: select, proxies: ['ğŸ¯ æœ¬æœºç›´è¿', 'ğŸš€ èŠ‚ç‚¹é€‰æ‹©', 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬|Auto','ğŸ‡­ğŸ‡° é¦™æ¸¯|Auto', 'ğŸ‡¹ğŸ‡¼ å°æ¹¾|Auto', 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡|Auto', 'ğŸ‡ºğŸ‡¸ ç¾å›½|Auto', 'ğŸ› ï¸ æ‰‹åŠ¨é€‰æ‹©'] }
pr: &pr {type: select, proxies: ['ğŸš€ èŠ‚ç‚¹é€‰æ‹©', 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬|Auto','ğŸ‡­ğŸ‡° é¦™æ¸¯|Auto', 'ğŸ‡¹ğŸ‡¼ å°æ¹¾|Auto', 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡|Auto', 'ğŸ‡ºğŸ‡¸ ç¾å›½|Auto', 'ğŸ¯ æœ¬æœºç›´è¿', 'ğŸ› ï¸ æ‰‹åŠ¨é€‰æ‹©'] }
######### é”šç‚¹ end #######

proxy-groups:
  - { name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©, type: select, proxies: ['â™»ï¸ Auto', 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬|Auto','ğŸ‡­ğŸ‡° é¦™æ¸¯|Auto', 'ğŸ‡¹ğŸ‡¼ å°æ¹¾|Auto', 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡|Auto', 'ğŸ‡ºğŸ‡¸ ç¾å›½|Auto', ğŸ¯ æœ¬æœºç›´è¿] }
  - { name: â™»ï¸ Auto, type: fallback, proxies: ['ğŸ‡¯ğŸ‡µ æ—¥æœ¬|Auto','ğŸ‡­ğŸ‡° é¦™æ¸¯|Auto', 'ğŸ‡¹ğŸ‡¼ å°æ¹¾|Auto', 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡|Auto', 'ğŸ‡ºğŸ‡¸ ç¾å›½|Auto'], <<: *fb }
  - { name: ğŸ¤– äººå·¥æ™ºèƒ½, type: select, <<: *pr }
  - { name: ğŸ“² ç”µæŠ¥æ¶ˆæ¯, type: select, <<: *pr }
  - { name: ğŸ“¹ æµ·å¤–è§†é¢‘, type: select, <<: *pr }
  - { name: ğŸ“§ è°·æ­ŒæœåŠ¡, type: select, <<: *pr }
  - { name: ğŸ“º å“”å“©å“”å“©, type: select, <<: *dr}
  - { name: ğŸ“ˆ ç½‘ç»œæµ‹è¯•, type: select, <<: *dr}
  - { name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, <<: *dr}
  
# èŠ‚ç‚¹ç»„  

  # è®¢é˜…èŠ‚ç‚¹
  - { name: ğŸ› ï¸ æ‰‹åŠ¨é€‰æ‹©, <<: *fb, use: [SubLink]}
  - { name: 'ğŸ‡­ğŸ‡° é¦™æ¸¯|Auto', <<: *fb, use: ['SubLink'], filter: "(?i)æ¸¯|hk|hongkong|hong kong" }
  - { name: 'ğŸ‡¹ğŸ‡¼ å°æ¹¾|Auto', <<: *fb, use: ['SubLink'],filter: "(?i)å°æ¹¾|tw" }
  - { name: 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡|Auto', <<: *fb, use: ['SubLink'],filter: "(?i)æ–°åŠ å¡|sg|singapore" }
  - { name: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬|Auto', <<: *fb, use: ['SubLink'],filter: "(?i)æ—¥æœ¬|jp|japan" }
  - { name: 'ğŸ‡ºğŸ‡¸ ç¾å›½|Auto', <<: *fb, use: ['SubLink'],filter: "(?i)ç¾å›½|us|usa" }

  # å›å®¶èŠ‚ç‚¹
  - { name: 'ğŸ  Home', <<: *fb, use: [Home], filter: "(?i)home"}

  # ç›´è¿èŠ‚ç‚¹
  - { name: ğŸ¯ æœ¬æœºç›´è¿, type: select, proxies: [DIRECT]}
  
rules:
  - AND,((DST-PORT,443),(NETWORK,UDP)),REJECT
  - AND,((SRC-IP-CIDR,192.168.50.0/24),(IP-CIDR,192.168.50.0/24)),DIRECT
  - IP-CIDR,192.168.50.0/24,ğŸ  Home
  - DOMAIN-SUFFIX,adobe.io,REJECT
  - DOMAIN-SUFFIX,xn--ngstr-lra8j.com,ğŸ“§ è°·æ­ŒæœåŠ¡
  - RULE-SET,private_domain,ğŸ¯ æœ¬æœºç›´è¿
  - RULE-SET,direct_domain,ğŸ¯ æœ¬æœºç›´è¿
  - RULE-SET,proxy_domain,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,talkatone_ad,REJECT
  - RULE-SET,talkatone_proxy,ğŸ‡ºğŸ‡¸ ç¾å›½|Auto
  - RULE-SET,networktest,ğŸ“ˆ ç½‘ç»œæµ‹è¯•
  - RULE-SET,spotify_domain,ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡|Auto
  - RUlE-SET,ai_domain_cn,ğŸ¯ æœ¬æœºç›´è¿
  - RULE-SET,ai_domain,ğŸ¤– äººå·¥æ™ºèƒ½
  - RULE-SET,ai_domain_!cn,ğŸ¤– äººå·¥æ™ºèƒ½
  - RULE-SET,github_domain,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,twitter_domain,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,youtube_domain,ğŸ“§ è°·æ­ŒæœåŠ¡
  - RULE-SET,google_domain,ğŸ“§ è°·æ­ŒæœåŠ¡
  - RULE-SET,telegram_domain,ğŸ“² ç”µæŠ¥æ¶ˆæ¯
  - RULE-SET,netflix_domain,ğŸ“¹ æµ·å¤–è§†é¢‘
  - RULE-SET,bahamut_domain,ğŸ“¹ æµ·å¤–è§†é¢‘
  - RULE-SET,bilibili_domain,ğŸ“º å“”å“©å“”å“©
  - RULE-SET,cn_domain,ğŸ¯ æœ¬æœºç›´è¿
  - RULE-SET,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,private_ip,ğŸ¯ æœ¬æœºç›´è¿,no-resolve
  - RULE-SET,netflix_ip,ğŸ“¹ æµ·å¤–è§†é¢‘,no-resolve
  - RULE-SET,telegram_ip,ğŸ“² ç”µæŠ¥æ¶ˆæ¯,no-resolve
  - RULE-SET,cn_ip,ğŸ¯ æœ¬æœºç›´è¿,no-resolve
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

######### é”šç‚¹ start #######
#è¿™é‡Œæ˜¯è§„åˆ™ç»„ç±»å‹ç›¸å…³çš„
domain: &domain {type: http, behavior: domain, format: mrs, interval: 86400}
ip: &ip {type: http, behavior: ipcidr, format: mrs, interval: 86400}
list: &list {type: http, behavior: domain, format: text, interval: 86400}
classical: &classical {type: http, behavior: classical, format: text, interval: 86400}
######### é”šç‚¹ end #######

rule-providers:
  fakeip-filter:
    url: "https://docker.lzdrc.cf/https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/fakeip-filter.mrs"
    path: "./rules/fakeip-filter.mrs"
    <<: *domain
  private_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs"
    path: "./rules/private.mrs"
  cn_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs"
    path: "./rules/cn.mrs"
  biliintl_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/biliintl.mrs"
    path: "./rules/biliintl.mrs"
  ai_domain_!cn:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/category-ai-!cn.mrs"
    path: "./rules/category-ai-!cn.mrs"
  ai_domain_cn:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/category-ai-cn.mrs"
    path: "./rules/category-ai-cn.mrs"
  github_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.mrs"
    path: "./rules/github.mrs"
  twitter_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/twitter.mrs"
    path: "./rules/twitter.mrs"
  youtube_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.mrs"
    path: "./rules/youtube.mrs"
  google_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs"
    path: "./rules/google.mrs"
  telegram_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.mrs"
    path: "./rules/telegram.mrs"
  netflix_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.mrs"
    path: "./rules/netflix.mrs"
  bilibili_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/bilibili.mrs"
    path: "./rules/bilibili.mrs"
  bahamut_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/bahamut.mrs"
    path: "./rules/bahamut.mrs"
  spotify_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/spotify.mrs"
    path: "./rules/spotify.mrs"
  pixiv_domain:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/pixiv.mrs"
    path: "./rules/pixiv.mrs"
  geolocation-!cn:
    <<: *domain
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs"
    path: "./rules/geolocation-!cn.mrs"
  private_ip:
    <<: *ip
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/private.mrs"
    path: "./rules/private.mrs"
  cn_ip:
    <<: *ip
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs"
    path: "./rules/cn.mrs"
  google_ip:
    <<: *ip
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.mrs"
    path: "./rules/google.mrs"
  netflix_ip:
    <<: *ip
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.mrs"
    path: "./rules/netflix.mrs"
  twitter_ip:
    <<: *ip
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/twitter.mrs"
    path: "./rules/twitter.mrs"
  telegram_ip:
    <<: *ip
    url: "https://docker.lzdrc.cf/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.mrs"
    path: "./rules/telegram.mrs"
  networktest:
    url: "https://docker.lzdrc.cf/https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/networktest.list"
    path: "./rules/networktest.list"
    <<: *classical
  talkatone_ad:
    url: "https://docker.lzdrc.cf/https://gist.githubusercontent.com/echowiz/f51837ac7525a75383c48275b9f4f692/raw/talkatone-ad.list"
    path: "./rules/talkatone-ad.list"
    <<: *classical
  talkatone_proxy:
    url: "https://docker.lzdrc.cf/https://gist.githubusercontent.com/echowiz/f51837ac7525a75383c48275b9f4f692/raw/talkatone-proxy.list"
    path: "./rules/talkatone-proxy.list"
    <<: *classical
  direct_domain:
    url: "https://docker.lzdrc.cf/https://gist.githubusercontent.com/echowiz/f51837ac7525a75383c48275b9f4f692/raw/direct.list"
    path: "./rules/direct.list"
    <<: *list
  proxy_domain:
    url: "https://docker.lzdrc.cf/https://gist.githubusercontent.com/echowiz/f51837ac7525a75383c48275b9f4f692/raw/proxy.list"
    path: "./rules/proxy.list"
    <<: *list
  ai_domain:
    url: "https://docker.lzdrc.cf/https://gist.githubusercontent.com/echowiz/f51837ac7525a75383c48275b9f4f692/raw/ai.list"
    path: "./rules/ai.list"
    <<: *list